# t.record.ublu
# Component of test.all ( )
# Test Suite for Ublu Midrange and Mainframe Life Cycle Extension language
# https://github.com/jwoehr/ublu
# Copyright (C) 2017 Jack J. Woehr http://www.softwoehr.com
# See the Ublu license (BSD-2 open source)

# Assumes called from test.all.ublu using the upper local @testsys
# include -s test_utils.ublu
# Already included from test.all.ublu
# Assumes residing in examples/test/suite
include ../../../examples/listsrc.ublu

# t.record ( @@work_dir @@outfile )
# ... work_dir - where tests can create files and leave them
# ... outfile - the report file from the tests
FUNC t.record ( work_dir outfile ) $[
    LOCAL @sys LOCAL @tmpfile LOCAL @result LOCAL @results
    map -to @results
    cat_fp ( @@work_dir t.record.listsrc.txt )
    put -to @tmpfile ~
    cat_fp ( *t_paradigm t.record.listsrc.txt )
    put -to @paradigm ~
    listsrcToLocalFile ( @testsys *t_record_source_mbr_fqp @tmpfile )
    string -to ~ -cat ${ diff -u }$ @tmpfile
    ~ -to ~ -bl
    ~ -to ~ -cat @paradigm
    lifo -dup put ~
    system -to ~ ~
    map -to @result
    lifo -dup
    calljava -to ~ -method getOutput -obj ~
    @result -add diff_text ~
    calljava -to ~ -method getRc -obj ~
    @result -add diff_rc ~
    put @result
    put ${ that's as far as test goes for record! }$
]$